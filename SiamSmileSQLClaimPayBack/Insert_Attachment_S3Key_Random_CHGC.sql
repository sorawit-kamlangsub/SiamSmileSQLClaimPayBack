DECLARE @DateFrom DATE = '2025-1-1';
DECLARE @DateTo DATE = '2025-12-11';
DECLARE @StartDateFrom DATETIME2 = @DateFrom;
DECLARE @EndDateTo DATETIME2	= DATEADD(DAY, 1, @DateTo);
DECLARE @D DATETIME	= GETDATE()
DECLARE @S3Bucket NVARCHAR(255) = 'p-isc-ss-1-bucketdata'
DECLARE @ClaimHeaderGroupCodes NVARCHAR(MAX) = 'BUAH-888-66020001-0,BUAH-888-66030001-0,BUAH-888-66030002-0,BUAH-888-66030003-0,BUAH-888-66030003-0,BUAH-888-66030003-0,BUAH-888-66030003-0,BUAH-888-66030003-0,BUAH-888-66030004-0,BUAH-888-66030004-0,BUAH-888-66030004-0,BUAH-888-66030005-0,BUAH-888-66030005-0,BUAH-888-66030005-0,BUAH-888-66030005-0,BUAH-888-66030005-0,BUAH-888-66030006-0,BUAH-888-66030006-0,BUAH-888-66030006-0,BUAH-888-66030006-0,BUAH-888-66030006-0,BUAH-888-66030007-0,BUAH-888-66030007-0,BUAH-888-66030007-0,BUAH-888-66030007-0,BUAH-888-66030008-0,BUAH-888-66030008-0,BUAH-888-66030008-0,BUAH-888-66030008-0,BUAH-888-66030008-0,BUAH-888-66030009-0,BUAH-888-66030009-0,BUAH-888-66030009-0,BUAH-888-66030010-0,BUAH-888-66030011-0,BUAH-888-66030011-0,BUAH-888-66030011-0,BUAH-888-66030011-0,BUAH-888-66040001-0,BUAH-888-66040002-0,BUAH-888-66040003-0,BUAH-888-66040004-0,BUAH-888-66040005-0,BUAH-888-66040006-0,BUAH-888-66040007-0,BUAH-888-66040008-0,BUAH-888-66040009-0,BUAH-888-66040010-0,BUAH-888-66040011-0,BUAH-888-66040012-0,BUAH-888-66040013-0,BUAH-888-66040014-0,BUAH-888-66040014-0,BUAH-888-66050001-0,BUAH-888-66050002-0,BUAH-888-66060001-0,BUAH-888-66090001-0,BUAH-888-66090004-0,BUAH-888-66090005-0,BUAH-888-66090006-0,BUAH-888-66090006-0,BUAH-888-66100002-0,BUAH-888-66100002-0,BUAH-888-66110001-0,BUAH-888-66110001-0,BUAH-888-66110001-0,BUAH-888-66110001-0,BUAH-888-66110001-0,BUAH-888-66110002-0,BUAH-888-66110002-0,BUAH-888-66110002-0,BUAH-888-66110002-0,BUAH-888-66110002-0,BUAH-888-66110003-0,BUAH-888-66110003-0,BUAH-888-66110003-0,BUAH-888-66110004-0,BUAH-888-66110004-0,BUAH-888-66110004-0,BUAH-888-66110004-0,BUAH-888-66110004-0,BUAH-888-66110005-0,BUAH-888-66110006-0,BUAH-888-66110007-0,BUAH-888-66110008-0,BUAH-888-66110009-0,BUAH-888-66110010-0,BUAH-888-66110011-0,BUAH-888-66110012-0,BUAH-888-66110013-0,BUAH-888-66110014-0,BUAH-888-66110014-0,BUAH-888-66110014-0,BUAH-888-66110015-0,BUAH-888-66110016-0,BUAH-888-66110017-0,BUAH-888-66110018-0,BUAH-888-66110019-0,BUAH-888-66110020-0,BUAH-888-66110020-0,BUAH-888-66110020-0,BUAH-888-66110021-0,BUAH-888-66110022-0,BUAH-888-66110023-0,BUAH-888-66110024-0,BUAH-888-66110024-0,BUAH-888-66110025-0,BUAH-888-66110026-0,BUAH-888-66110027-0,BUAH-888-66110028-0,BUAH-888-66110030-0,BUAH-888-66110031-0,BUAH-888-66110032-0,BUAH-888-66110033-0,BUAH-888-66110034-0,BUAH-888-66110035-0,BUAH-888-66110036-0,BUAH-888-66110037-0,BUAH-888-66110038-0,BUAH-888-66120001-0,BUAH-888-67010002-0,BUAH-888-67060001-0,BUAH-888-67060002-0,BUAH-888-67080001-0,BUAH-888-67080002-0,BUAH-888-67080003-0,BUAH-888-67080004-0,BUAH-888-67080005-0,BUAH-888-67080007-0,BUAH-888-67080007-0,BUAH-888-67080008-0,BUAH-888-67080008-0,BUAH-888-67080009-0,BUAH-888-67080010-0,BUAH-888-67100001-0,BUAH-888-68040001-0,BUAH-888-68040002-0,BUAH-888-68040003-0,BUAH-888-68040004-0,BUAH-888-68040006-0,BUAH-888-68040007-0,BUAH-888-68040009-0,BUHH-221-66110001-0,BUHH-888-65120001-0,BUHH-888-65120001-0,BUHH-888-65120001-0,BUHH-888-65120002-0,BUHH-888-65120002-0,BUHH-888-65120002-0,BUHH-888-65120002-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-65120003-0,BUHH-888-66010001-0,BUHH-888-66010002-0,BUHH-888-66010003-0,BUHH-888-66030001-0,BUHH-888-66030005-0,BUHH-888-66040002-0,BUHH-888-66040003-0,BUHH-888-66040004-0,BUHH-888-66040005-0,BUHH-888-66040006-0,BUHH-888-66040007-0,BUHH-888-66050001-0,BUHH-888-66050002-0,BUHH-888-66060001-0,BUHH-888-66090001-0,BUHH-888-66100002-0,BUHH-888-66100004-0,BUHH-888-66100005-0,BUHH-888-66100006-0,BUHH-888-66100007-0,BUHH-888-66110001-0,BUHH-888-66110004-0,BUHH-888-66110006-0,BUHH-888-66110007-0,BUHH-888-66110008-0,BUHH-888-66110009-0,BUHH-888-66110010-0,BUHH-888-66110011-0,BUHH-888-66110012-0,BUHH-888-66110013-0,BUHH-888-66110014-0,BUHH-888-66110017-0,BUHH-888-66110018-0,BUHH-888-66110019-0,BUHH-888-66110020-0,BUHH-888-66110021-0,BUHH-888-66110022-0,BUHH-888-66110023-0,BUHH-888-66110024-0,BUHH-888-66110025-0,BUHH-888-66110026-0,BUHH-888-66110027-0,BUHH-888-66110028-0,BUHH-888-66110029-0,BUHH-888-66110030-0,BUHH-888-66110031-0,BUHH-888-66110032-0,BUHH-888-66110033-0,BUHH-888-66110034-0,BUHH-888-66110035-0,BUHH-888-66110036-0,BUHH-888-66110037-0,BUHH-888-66110038-0,BUHH-888-66110040-0,BUHH-888-66110041-0,BUHH-888-66110042-0,BUHH-888-66110043-0,BUHH-888-66110044-0,BUHH-888-66110045-0,BUHH-888-66110047-0,BUHH-888-66110048-0,BUHH-888-66110049-0,BUHH-888-66120002-0,BUHH-888-66120003-0,BUHH-888-66120003-0,BUHH-888-66120007-0,BUHH-888-66120008-0,BUHH-888-66120010-0,BUHH-888-66120013-0,BUHH-888-66120014-0,BUHH-888-66120016-0,BUHH-888-66120017-0,BUHH-888-66120018-0,BUHH-888-66120019-0,BUHH-888-66120020-0,BUHH-888-66120021-0,BUHH-888-66120022-0,BUHH-888-66120023-0,BUHH-888-66120024-0,BUHH-888-66120025-0,BUHH-888-66120026-0,BUHH-888-66120027-0,BUHH-888-66120028-0,BUHH-888-66120029-0,BUHH-888-66120030-0,BUHH-888-66120031-0,BUHH-888-66120035-0,BUHH-888-67010001-0,BUHH-888-67010007-0,BUHH-888-67030007-0,BUHH-888-67030008-0,BUHH-888-67030012-0,BUHH-888-67030013-0,BUHH-888-67030015-0,BUHH-888-67050003-0,BUHH-888-67050005-0,BUHH-888-67050006-0,BUHH-888-67050007-0,BUHH-888-67050008-0,BUHH-888-67050009-0,BUHH-888-67050010-0,BUHH-888-67060001-0,BUHH-888-67060002-0,BUHH-888-67060003-0,BUHH-888-67060004-0,BUHH-888-67060005-0,BUHH-888-67060006-0,BUHH-888-67060007-0,BUHH-888-67060008-0,BUHH-888-67060009-0,BUHH-888-67060010-0,BUHH-888-67060011-0,BUHH-888-67060012-0,BUHH-888-67060013-0,BUHH-888-67060014-0,BUHH-888-67060015-0,BUHH-888-67060016-0,BUHH-888-67060017-0,BUHH-888-67060018-0,BUHH-888-67060019-0,BUHH-888-67060020-0,BUHH-888-67060021-0,BUHH-888-67060022-0,BUHH-888-67060023-0,BUHH-888-67060024-0,BUHH-888-67060025-0,BUHH-888-67060026-0,BUHH-888-67060027-0,BUHH-888-67060028-0,BUHH-888-67060029-0,BUHH-888-67060030-0,BUHH-888-67060031-0,BUHH-888-67060032-0,BUHH-888-67060033-0,BUHH-888-67060034-0,BUHH-888-67060035-0,BUHH-888-67060036-0,BUHH-888-67060037-0,BUHH-888-67060038-0,BUHH-888-67060039-0,BUHH-888-67060040-0,BUHH-888-67060041-0,BUHH-888-67060043-0,BUHH-888-67060044-0,BUHH-888-67060045-0,BUHH-888-67060046-0,BUHH-888-67060047-0,BUHH-888-67060048-0,BUHH-888-67060049-0,BUHH-888-67070001-0,BUHH-888-67070002-0,BUHH-888-67070003-0,BUHH-888-67070004-0,BUHH-888-67070005-0,BUHH-888-67070006-0,BUHH-888-67070007-0,BUHH-888-67070010-0,BUHH-888-67070012-0,BUHH-888-67070013-0,BUHH-888-67070023-0,BUHH-888-67070024-0,BUHH-888-67070025-0,BUHH-888-67070026-0,BUHH-888-67070027-0,BUHH-888-67070028-0,BUHH-888-67070031-0,BUHH-888-67070033-0,BUHH-888-67070034-0,BUHH-888-67070035-0,BUHH-888-67070036-0,BUHH-888-67070039-0,BUHH-888-67070040-0,BUHH-888-67070041-0,BUHH-888-67070042-0,BUHH-888-67070043-0,BUHH-888-67070044-0,BUHH-888-67070045-0,BUHH-888-67070046-0,BUHH-888-67080001-0,BUHH-888-67080002-0,BUHH-888-67080003-0,BUHH-888-67080004-0,BUHH-888-67080005-0,BUHH-888-67080006-0,BUHH-888-67080007-0,BUHH-888-67080008-0,BUHH-888-67080009-0,BUHH-888-67080010-0,BUHH-888-67080011-0,BUHH-888-67080012-0,BUHH-888-67080013-0,BUHH-888-67080014-0,BUHH-888-67080015-0,BUHH-888-67080016-0,BUHH-888-67080017-0,BUHH-888-67080018-0,BUHH-888-67080019-0,BUHH-888-67080020-0,BUHH-888-67080021-0,BUHH-888-67080022-0,BUHH-888-67080023-0,BUHH-888-67080024-0,BUHH-888-67080025-0,BUHH-888-67080026-0,BUHH-888-67080027-0,BUHH-888-67080028-0,BUHH-888-67080029-0,BUHH-888-67080030-0,BUHH-888-67080031-0,BUHH-888-67080032-0,BUHH-888-67080033-0,BUHH-888-67080034-0,BUHH-888-67080035-0,BUHH-888-67080036-0,BUHH-888-67080037-0,BUHH-888-67080038-0,BUHH-888-67080039-0,BUHH-888-67080040-0,BUHH-888-67080041-0,BUHH-888-67080042-0,BUHH-888-67080043-0,BUHH-888-67080044-0,BUHH-888-67080045-0,BUHH-888-67080046-0,BUHH-888-67080047-0,BUHH-888-67080048-0,BUHH-888-67080049-0,BUHH-888-67080050-0,BUHH-888-67080051-0,BUHH-888-67080052-0,BUHH-888-67080053-0,BUHH-888-67080054-0,BUHH-888-67080055-0,BUHH-888-67080056-0,BUHH-888-67080057-0,BUHH-888-67080058-0,BUHH-888-67080059-0,BUHH-888-67080060-0,BUHH-888-67080061-0,BUHH-888-67080062-0,BUHH-888-67080063-0,BUHH-888-67080064-0,BUHH-888-67080065-0,BUHH-888-67080066-0,BUHH-888-67080067-0,BUHH-888-67080068-0,BUHH-888-67080069-0,BUHH-888-67080070-0,BUHH-888-67080071-0,BUHH-888-67080072-0,BUHH-888-67080073-0,BUHH-888-67080074-0,BUHH-888-67080075-0,BUHH-888-67080076-0,BUHH-888-67080077-0,BUHH-888-67080078-0,BUHH-888-67080079-0,BUHH-888-67080080-0,BUHH-888-67080081-0,BUHH-888-67080082-0,BUHH-888-67080083-0,BUHH-888-67080084-0,BUHH-888-67080085-0,BUHH-888-67080086-0,BUHH-888-67080087-0,BUHH-888-67080088-0,BUHH-888-67080089-0,BUHH-888-67080090-0,BUHH-888-67080091-0,BUHH-888-67080092-0,BUHH-888-67080093-0,BUHH-888-67080094-0,BUHH-888-67080095-0,BUHH-888-67080096-0,BUHH-888-67080097-0,BUHH-888-67080098-0,BUHH-888-67080099-0,BUHH-888-67080100-0,BUHH-888-67080101-0,BUHH-888-67080102-0,BUHH-888-67080103-0,BUHH-888-68020001-0,BUHH-888-68050001-0,BUHH-888-68050002-0,BUHH-888-68050003-0,BUHH-888-68050004-0,BUHH-888-68050005-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120001-0,SBAH-888-65120005-0,SBAH-888-66010001-0,SBAH-888-66010002-0,SBAH-888-66020001-0,SBAH-888-66030001-0,SBAH-888-66030001-0,SBAH-888-66030001-0,SBAH-888-66030001-0,SBAH-888-66030001-0,SBAH-888-66030002-0,SBAH-888-66030003-0,SBAH-888-66030003-0,SBAH-888-66040001-0,SBAH-888-66040002-0,SBAH-888-66040003-0,SBAH-888-66040004-0,SBAH-888-66040005-0,SBAH-888-66050001-0,SBAH-888-66050002-0,SBAH-888-66060001-0,SBAH-888-66100001-0,SBAH-888-66110001-0,SBAH-888-66110002-0,SBAH-888-66110003-0,SBAH-888-66110004-0,SBAH-888-66110005-0,SBAH-888-66110006-0,SBAH-888-66110007-0,SBAH-888-66110008-0,SBAH-888-66110009-0,SBAH-888-66110010-0,SBAH-888-66110011-0,SBAH-888-66110012-0,SBAH-888-66110013-0,SBAH-888-66110014-0,SBAH-888-66110015-0,SBAH-888-66110016-0,SBAH-888-66110017-0,SBAH-888-66110018-0,SBAH-888-66110019-0,SBAH-888-66110020-0,SBAH-888-66120001-0,SBAH-888-66120001-0,SBAH-888-67070001-0,SBHH-888-66050001-0,SBHH-888-66050002-0,SBHH-888-66050003-0,SBHH-888-66050003-0,SBHH-888-66100002-0,SBHH-888-66100003-0,SBHH-888-66100004-0,SBHH-888-66100005-0,SBHH-888-66100009-0,SBHH-888-66100010-0,SBHH-888-66100013-0,SBHH-888-66100016-0,SBHH-888-66100016-0,SBHH-888-66110002-0,SBHH-888-66110003-0,SBHH-888-66110004-0,SBHH-888-66110005-0,SBHH-888-66110006-0,SBHH-888-66110007-0,SBHH-888-66110008-0,SBHH-888-66110009-0,SBHH-888-66110010-0,SBHH-888-66110011-0,SBHH-888-66110012-0,SBHH-888-66110013-0,SBHH-888-66110014-0,SBHH-888-66110015-0,SBHH-888-66110016-0,SBHH-888-66110019-0,SBHH-888-66110020-0,SBHH-888-66110021-0,SBHH-888-66110022-0,SBHH-888-66110023-0,SBHH-888-66110024-0,SBHH-888-66110025-0,SBHH-888-66110026-0,SBHH-888-66110030-0,SBHH-888-66120002-0,SBHH-888-66120004-0,SBHH-888-66120005-0,SBHH-888-66120006-0,SBHH-888-66120011-0,SBHH-888-66120014-0,SBHH-888-66120015-0,SBHH-888-66120016-0,SBHH-888-66120017-0,SBHH-888-66120018-0,SBHH-888-66120019-0,SBHH-888-66120020-0,SBHH-888-66120021-0,SBHH-888-66120022-0,SBHH-888-66120023-0,SBHH-888-66120024-0,SBHH-888-66120025-0,SBHH-888-66120026-0,SBHH-888-67010010-0,SBHH-888-67010013-0,SBHH-888-67030001-0,SBHH-888-67050002-0,SBHH-888-67050004-0,SBHH-888-67050005-0,SBHH-888-67050006-0,SBHH-888-67050007-0,SBHH-888-67050008-0,SBHH-888-67050009-0,SBHH-888-67050010-0,SBHH-888-67050011-0,SBHH-888-67060002-0,SBHH-888-67060003-0,SBHH-888-67060004-0,SBHH-888-67060005-0,SBHH-888-67060006-0,SBHH-888-67060007-0,SBHH-888-67060008-0,SBHH-888-67060009-0,SBHH-888-67060010-0,SBHH-888-67060011-0,SBHH-888-67060012-0,SBHH-888-67060013-0,SBHH-888-67060014-0,SBHH-888-67060015-0,SBHH-888-67060016-0,SBHH-888-67060017-0,SBHH-888-67060019-0,SBHH-888-67060020-0,SBHH-888-67060021-0,SBHH-888-67060022-0,SBHH-888-67060023-0,SBHH-888-67060024-0,SBHH-888-67060025-0,SBHH-888-67060026-0,SBHH-888-67060027-0,SBHH-888-67060028-0,SBHH-888-67060029-0,SBHH-888-67060030-0,SBHH-888-67060031-0,SBHH-888-67060032-0,SBHH-888-67060033-0,SBHH-888-67060034-0,SBHH-888-67060035-0,SBHH-888-67060036-0,SBHH-888-67060037-0,SBHH-888-67060038-0,SBHH-888-67060039-0,SBHH-888-67060040-0,SBHH-888-67060041-0,SBHH-888-67060042-0,SBHH-888-67060043-0,SBHH-888-67060044-0,SBHH-888-67060045-0,SBHH-888-67060046-0,SBHH-888-67060047-0,SBHH-888-67060048-0,SBHH-888-67060049-0,SBHH-888-67060050-0,SBHH-888-67060051-0,SBHH-888-67060052-0,SBHH-888-67060053-0,SBHH-888-67070011-0,SBHH-888-67070012-0,SBHH-888-67070013-0,SBHH-888-67070014-0,SBHH-888-67070016-0,SBHH-888-67070017-0,SBHH-888-67070018-0,SBHH-888-67070019-0,SBHH-888-67070020-0,SBHH-888-67070021-0,SBHH-888-67070022-0,SBHH-888-67070023-0,SBHH-888-67080001-0,SBHH-888-67080002-0,SBHH-888-67080003-0,SBHH-888-67080004-0,SBHH-888-67080005-0,SBHH-888-67080006-0,SBHH-888-67080007-0,SBHH-888-67080008-0,SBHH-888-67080009-0,SBHH-888-67080010-0,SBHH-888-67080011-0,SBHH-888-67080012-0,SBHH-888-67080013-0,SBHH-888-67080014-0,SBHH-888-67080015-0,SBHH-888-67080016-0,SBHH-888-67080017-0,SBHH-888-67080018-0,SBHH-888-67080019-0,SBHH-888-67080020-0,SBHH-888-67080021-0,SBHH-888-67080022-0,SBHH-888-67080023-0,SBHH-888-67080024-0,SBHH-888-67080025-0,SBHH-888-67080026-0,SBHH-888-67080027-0,SBHH-888-67080028-0,SBHH-888-67080029-0,SBHH-888-67080030-0,SBHH-888-67080031-0,SBHH-888-67080032-0,SBHH-888-67080033-0,SBHH-888-67080034-0,SBHH-888-67080035-0,SBHH-888-67080036-0,SBHH-888-67080037-0,SBHH-888-67080038-0,SBHH-888-67080039-0,SBHH-888-67080040-0,SBHH-888-67080041-0,SBHH-888-67080042-0,SBHH-888-67080043-0,SBHH-888-67080044-0,SBHH-888-67080045-0,SBHH-888-67080046-0,SBHH-888-67080047-0,SBHH-888-67080048-0,SBHH-888-67080049-0,SBHH-888-67080050-0,SBHH-888-67080051-0,SBHH-888-67080052-0,SBHH-888-67080053-0,SBHH-888-67080056-0,SBHH-888-67080057-0,SBHH-888-67080058-0,SBHH-888-67080059-0,SBHH-888-67080060-0,SBHH-888-67080061-0,SBHH-888-67080062-0,SBHH-888-67080063-0,SBHH-888-67080064-0,SBHH-888-67080065-0,SBHH-888-67080066-0,SBHH-888-67080067-0,SBHH-888-67080068-0,SBHH-888-67080069-0,SBHH-888-67080070-0,SBHH-888-67080071-0,SBHH-888-67080072-0,SBHH-888-67080073-0,SBHH-888-67080074-0,SBHH-888-67080075-0,SBHH-888-67080076-0,SBHH-888-67080077-0,SBHH-888-67080078-0,SBHH-888-67080079-0,SBHH-888-67080091-0,SBHH-888-67090001-0,SBHH-888-68060001-0,SBHH-920-65050001-0,SEAH-888-65120001-0,SEAH-888-65120002-0,SEAH-888-66010001-0,SEAH-888-66010001-0,SEAH-888-66010002-0,SEAH-888-66020001-0,SEAH-888-66030001-0,SEAH-888-66030001-0,SEAH-888-66030002-0,SEAH-888-66030002-0,SEAH-888-66030002-0,SEAH-888-66030002-0,SEAH-888-66040002-0,SEAH-888-66040003-0,SEAH-888-66050001-0,SEAH-888-66050002-0,SEAH-888-67060001-0,SEAH-888-67060001-0,SEAH-888-67060001-0,SEAH-888-67060001-0,SEAH-888-67060001-0,SEHH-888-65020003-0,SEHH-888-65020005-0,SEHH-888-65020006-0,SEHH-888-65020007-0,SEHH-888-65020008-0,SEHH-888-65020009-0,SEHH-888-65020010-0,SEHH-888-65020010-0,SEHH-888-65020011-0,SEHH-888-65060001-0,SEHH-888-65110001-0,SEHH-888-65110001-0,SEHH-888-65120001-0,SEHH-888-65120003-0,SEHH-888-66010001-0,SEHH-888-66010002-0,SEHH-888-66040001-0,SEHH-888-66040002-0,SEHH-888-66040003-0,SEHH-888-66040004-0,SEHH-888-66040005-0,SEHH-888-66040006-0,SEHH-888-66040007-0,SEHH-888-66040008-0,SEHH-888-66040009-0,SEHH-888-66040010-0,SEHH-888-66040011-0,SEHH-888-66050002-0,SEHH-888-66080001-0,SEHH-888-66100001-0,SEHH-888-66100002-0,SEHH-888-66100004-0,SEHH-888-66100005-0,SEHH-888-66100006-0,SEHH-888-66100007-0,SEHH-888-66100008-0,SEHH-888-66100010-0,SEHH-888-66110004-0,SEHH-888-66110005-0,SEHH-888-66110006-0,SEHH-888-66110007-0,SEHH-888-66110008-0,SEHH-888-66110009-0,SEHH-888-66110010-0,SEHH-888-66110011-0,SEHH-888-66110012-0,SEHH-888-66110013-0,SEHH-888-66110014-0,SEHH-888-66110015-0,SEHH-888-66110016-0,SEHH-888-66110017-0,SEHH-888-66110018-0,SEHH-888-66110019-0,SEHH-888-66110020-0,SEHH-888-66110021-0,SEHH-888-66110022-0,SEHH-888-66110023-0,SEHH-888-66110024-0,SEHH-888-66110025-0,SEHH-888-66110026-0,SEHH-888-66110027-0,SEHH-888-66110034-0,SEHH-888-66110035-0,SEHH-888-66110036-0,SEHH-888-66110037-0,SEHH-888-66110038-0,SEHH-888-66110039-0,SEHH-888-66110040-0,SEHH-888-66110041-0,SEHH-888-66110043-0,SEHH-888-66110044-0,SEHH-888-66110045-0,SEHH-888-66110047-0,SEHH-888-66110048-0,SEHH-888-66110049-0,SEHH-888-66110050-0,SEHH-888-66110051-0,SEHH-888-66120002-0,SEHH-888-66120005-0,SEHH-888-66120006-0,SEHH-888-66120007-0,SEHH-888-66120008-0,SEHH-888-66120013-0,SEHH-888-66120014-0,SEHH-888-66120015-0,SEHH-888-66120016-0,SEHH-888-66120017-0,SEHH-888-66120018-0,SEHH-888-66120019-0,SEHH-888-66120020-0,SEHH-888-66120021-0,SEHH-888-66120022-0,SEHH-888-66120023-0,SEHH-888-66120024-0,SEHH-888-66120025-0,SEHH-888-66120026-0,SEHH-888-66120027-0,SEHH-888-66120028-0,SEHH-888-66120029-0,SEHH-888-66120030-0,SEHH-888-66120031-0,SEHH-888-66120032-0,SEHH-888-66120033-0,SEHH-888-66120034-0,SEHH-888-66120035-0,SEHH-888-66120036-0,SEHH-888-66120037-0,SEHH-888-66120038-0,SEHH-888-66120039-0,SEHH-888-66120040-0,SEHH-888-66120041-0,SEHH-888-66120042-0,SEHH-888-66120043-0,SEHH-888-66120044-0,SEHH-888-66120045-0,SEHH-888-66120046-0,SEHH-888-66120047-0,SEHH-888-66120048-0,SEHH-888-66120049-0,SEHH-888-67010001-0,SEHH-888-67010020-0,SEHH-888-67010027-0,SEHH-888-67010032-0,SEHH-888-67010033-0,SEHH-888-67020004-0,SEHH-888-67040004-0,SEHH-888-67040005-0,SEHH-888-67040006-0,SEHH-888-67050001-0,SEHH-888-67050003-0,SEHH-888-67050005-0,SEHH-888-67050006-0,SEHH-888-67050007-0,SEHH-888-67050008-0,SEHH-888-67050011-0,SEHH-888-67050012-0,SEHH-888-67050013-0,SEHH-888-67050014-0,SEHH-888-67050015-0,SEHH-888-67050016-0,SEHH-888-67050017-0,SEHH-888-67050018-0,SEHH-888-67050020-0,SEHH-888-67050022-0,SEHH-888-67050023-0,SEHH-888-67050024-0,SEHH-888-67050025-0,SEHH-888-67050026-0,SEHH-888-67050027-0,SEHH-888-67050028-0,SEHH-888-67050029-0,SEHH-888-67060003-0,SEHH-888-67060004-0,SEHH-888-67060010-0,SEHH-888-67060011-0,SEHH-888-67060012-0,SEHH-888-67060013-0,SEHH-888-67060014-0,SEHH-888-67060025-0,SEHH-888-67060026-0,SEHH-888-67060027-0,SEHH-888-67060028-0,SEHH-888-67060029-0,SEHH-888-67060030-0,SEHH-888-67060031-0,SEHH-888-67060032-0,SEHH-888-67060033-0,SEHH-888-67060034-0,SEHH-888-67060040-0,SEHH-888-67060041-0,SEHH-888-67060042-0,SEHH-888-67060049-0,SEHH-888-67060051-0,SEHH-888-67060054-0,SEHH-888-67060055-0,SEHH-888-67060057-0,SEHH-888-67060058-0,SEHH-888-67060059-0,SEHH-888-67060060-0,SEHH-888-67060061-0,SEHH-888-67060062-0,SEHH-888-67060063-0,SEHH-888-67060064-0,SEHH-888-67060065-0,SEHH-888-67060066-0,SEHH-888-67060067-0,SEHH-888-67060068-0,SEHH-888-67060069-0,SEHH-888-67060070-0,SEHH-888-67060071-0,SEHH-888-67060072-0,SEHH-888-67060073-0,SEHH-888-67060074-0,SEHH-888-67060075-0,SEHH-888-67060076-0,SEHH-888-67060077-0,SEHH-888-67060078-0,SEHH-888-67060079-0,SEHH-888-67060080-0,SEHH-888-67060081-0,SEHH-888-67060083-0,SEHH-888-67060084-0,SEHH-888-67060085-0,SEHH-888-67060086-0,SEHH-888-67060087-0,SEHH-888-67060088-0,SEHH-888-67060089-0,SEHH-888-67060090-0,SEHH-888-67060091-0,SEHH-888-67060092-0,SEHH-888-67060094-0,SEHH-888-67060095-0,SEHH-888-67060096-0,SEHH-888-67060097-0,SEHH-888-67060099-0,SEHH-888-67060100-0,SEHH-888-67060102-0,SEHH-888-67060103-0,SEHH-888-67060104-0,SEHH-888-67060105-0,SEHH-888-67060106-0,SEHH-888-67060107-0,SEHH-888-67060109-0,SEHH-888-67060110-0,SEHH-888-67060111-0,SEHH-888-67060112-0,SEHH-888-67060113-0,SEHH-888-67060114-0,SEHH-888-67060115-0,SEHH-888-67060116-0,SEHH-888-67060117-0,SEHH-888-67060118-0,SEHH-888-67060119-0,SEHH-888-67060120-0,SEHH-888-67060121-0,SEHH-888-67060122-0,SEHH-888-67060124-0,SEHH-888-67060125-0,SEHH-888-67060126-0,SEHH-888-67060127-0,SEHH-888-67060129-0,SEHH-888-67060130-0,SEHH-888-67070001-0,SEHH-888-67070002-0,SEHH-888-67070003-0,SEHH-888-67070005-0,SEHH-888-67070007-0,SEHH-888-67070008-0,SEHH-888-67070009-0,SEHH-888-67070010-0,SEHH-888-67070011-0,SEHH-888-67070012-0,SEHH-888-67070013-0,SEHH-888-67070016-0,SEHH-888-67070017-0,SEHH-888-67070018-0,SEHH-888-67070021-0,SEHH-888-67070022-0,SEHH-888-67070023-0,SEHH-888-67070024-0,SEHH-888-67070025-0,SEHH-888-67070026-0,SEHH-888-67070027-0,SEHH-888-67070028-0,SEHH-888-67080001-0,SEHH-888-67080002-0,SEHH-888-67080003-0,SEHH-888-67080004-0,SEHH-888-67080005-0,SEHH-888-67080006-0,SEHH-888-67080007-0,SEHH-888-67080008-0,SEHH-888-67080009-0,SEHH-888-67080010-0,SEHH-888-67080011-0,SEHH-888-67080013-0,SEHH-888-67080014-0,SEHH-888-67080015-0,SEHH-888-67080016-0,SEHH-888-67080017-0,SEHH-888-67080018-0,SEHH-888-67080019-0,SEHH-888-67080020-0,SEHH-888-67080021-0,SEHH-888-67080022-0,SEHH-888-67080023-0,SEHH-888-67080024-0,SEHH-888-67080025-0,SEHH-888-67080026-0,SEHH-888-67080027-0,SEHH-888-67080029-0,SEHH-888-67080034-0,SEHH-888-67080035-0,SEHH-888-67080036-0,SEHH-888-67080037-0,SEHH-888-67080038-0,SEHH-888-67080040-0,SEHH-888-67080041-0,SEHH-888-67080045-0,SEHH-888-67080058-0,SEHH-888-67110001-0,SEHH-888-68040002-0,SEHH-888-68040013-0,SEHH-888-68050001-0,SEHH-888-68070001-0,SEHH-888-68090002-0,SEHH-888-68100002-0,SEPH-888-67010002-0,SEPH-888-67060001-0,SEPH-888-67060002-0,SEPH-888-67060003-0,SEPH-888-67060004-0,TSAH-888-66070004-0,TSAH-888-66080004-0,TSAH-888-66090001-0,TSAH-888-66100002-0,TSAH-888-66110001-0,TSAH-888-66110001-0,TSAH-888-66110001-0,TSAH-888-66110001-0,TSAH-888-66110001-0,TSAH-888-66110002-0,TSAH-888-66110002-0,TSAH-888-66110002-0,TSAH-888-66110002-0,TSAH-888-66110003-0,TSAH-888-66110003-0,TSAH-888-66110003-0,TSAH-888-66110003-0,TSAH-888-66110003-0,TSAH-888-66110004-0,TSAH-888-66110004-0,TSAH-888-66110004-0,TSAH-888-66110004-0,TSAH-888-66110004-0,TSAH-888-66110005-0,TSAH-888-66110005-0,TSAH-888-66110005-0,TSAH-888-66110005-0,TSAH-888-66110005-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110006-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110007-0,TSAH-888-66110008-0,TSAH-888-66110010-0,TSAH-888-67110001-0,TSAH-888-68020002-0,TSAH-888-68030001-0,TSAH-888-68030002-0,TSAH-888-68030004-0,TSAH-888-68030005-0,TSAH-888-68040008-0,TSAH-888-68040010-0,TSAH-888-68040011-0,TSAH-888-68050003-0,TSAH-888-68050005-0,TSAH-888-68050007-0,TSAH-888-68050008-0,TSAH-888-68050009-0,TSAH-888-68050010-0,TSAH-888-68080005-0,TSAH-888-68090001-0,TSAH-888-68090002-0,TSAH-888-68090003-0,TSAH-888-68090010-0,TSAH-888-68100014-0,TSHH-221-66110001-0,TSHH-888-66120002-0,TSHH-888-67030062-0,TSHH-888-67040068-0,TSHH-888-67040069-0,TSHH-888-67040070-0,TSHH-888-67060013-0,TSHH-888-67060014-0,TSHH-888-67060015-0,TSHH-888-67060021-0,TSHH-888-67080001-0,TSHH-888-67080002-0,TSHH-888-67080003-0,TSHH-888-67080004-0,TSHH-888-67080005-0,TSHH-888-67080006-0,TSHH-888-67080007-0,TSHH-888-67080008-0,TSHH-888-67080010-0,TSHH-888-68030001-0,TSHH-888-68030002-0,TSHH-888-68030003-0,TSHH-888-68030004-0,TSHH-888-68030005-0,TSHH-888-68030006-0,TSHH-888-68050001-0,TSHH-888-68050002-0,TSHH-888-68050003-0,TSHH-888-68050005-0,TSPH-888-67090003-0,TSPH-888-67110001-0'


	SELECT DISTINCT Element
	INTO #Tmplst
	from dbo.func_SplitStringToTable(@ClaimHeaderGroupCodes,',');
		
	SELECT
		td.ClaimHeaderGroupCodeInDB
		,1 ItemCode
		,IIF(ISNULL(td.TotalAmount,0) = 0 ,td.TotalAmountSS,td.TotalAmount)	Amount
		,ISNULL(td.TotalAmount,0)	TotalAmount
		,ISNULL(td.TotalAmountSS,0)	TotalAmountSS
		,td.InsuranceCompanyId
		,td.ClaimHeaderCodeInDB
		,td.ProductGroup
		,td.PolicyNo
		,td.CreatedDate
		,IDENTITY(INT, 1, 1) AS RowNo
	INTO #Tmp
	FROM
		(	--SSS------
			SELECT h.ClaimHeaderGroup_id					AS ClaimHeaderGroupCodeInDB
					,CAST(v.Pay_Total AS DECIMAL(16,2))		AS TotalAmount
					,v.PaySS_Total							AS TotalAmountSS
					,ins.Organize_ID						AS InsuranceCompanyId
					,h.Code									AS ClaimHeaderCodeInDB
					,IIF(h.Product_id = 'P30',h.Product_id,'1000') AS ProductGroup
					,cus.InsuredPolicy_no					AS PolicyNo
					,h.CreatedDate
			FROM SSS.dbo.DB_ClaimHeader h
				LEFT JOIN SSS.dbo.DB_ClaimVoucher v
					ON h.Code = v.Code
				LEFT JOIN DataCenterV1.Organize.Organize ins
					ON h.InsuranceCompany_id = ins.OrganizeCode
				LEFT JOIN sss.dbo.MT_ClaimType ct
					ON h.ClaimAdmitType_id = ct.Code
				LEFT JOIN sss.dbo.DB_Customer  cus
					ON h.App_id = cus.App_id

			UNION
			--SSSPA------
			SELECT hg.Code								AS ClaimHeaderGroupCodeInDB
					,CAST(h.Amount_Pay AS DECIMAL(16,2))	AS TotalAmount
					,h.PaySS_Total							AS TotalAmountSS
					,ins.Organize_ID						AS InsuranceCompanyId
					,h.Code									AS ClaimHeaderCodeInDB
					,'2000'									AS ProductGroup
					,ctp.Detail								AS PolicyNo
					,hg.CreatedDate
			FROM SSSPA.dbo.DB_ClaimHeaderGroup AS hg
				LEFT JOIN SSSPA.dbo.DB_ClaimHeader h
					ON hg.Code = h.ClaimheaderGroup_id
				LEFT JOIN DataCenterV1.Organize.Organize AS ins
					ON hg.InsuranceCompany_id = ins.OrganizeCode
				LEFT JOIN SSSPA.dbo.DB_CustomerDetail AS ctd
					ON h.CustomerDetail_id = ctd.Code
				LEFT JOIN SSSPA.dbo.DB_Customer AS cus
					ON ctd.Application_id = cus.App_id AND cus.Status_id <> '3090' --ไม่ใช่ยกเลิกกรมธรรม์
				LEFT JOIN SSSPA.dbo.DB_CustomerPolicy  AS ctp
					ON cus.App_id  = ctp.App_id AND PolicyType_id = '9601' --เป็นเลขกรมธรรม์ ปกติ

			UNION

			--ClaimCompensate------
			SELECT cg.ClaimCompensateGroupCode				AS ClaimHeaderGroupCodeInDB
				,cc.CompensateRemain						AS TotalAmount
				,cc.CompensateRemain						AS TotalAmountSS
				,ins.Organize_ID							AS InsuranceCompanyId
				,cc.ClaimCompensateCode						AS ClaimHeaderCodeInDB
				,'2222'										AS ProductGroup
				,cus.InsuredPolicy_no						AS PolicyNo
				,cg.CreatedDate
			FROM SSS.dbo.ClaimCompensateGroup cg
				LEFT JOIN
					(
						SELECT 
							CompensateRemain
							,ClaimCompensateCode
							,ClaimCompensateGroupId
						FROM SSS.dbo.ClaimCompensate
						WHERE IsActive = 1
					)cc
					ON cg.ClaimCompensateGroupId = cc.ClaimCompensateGroupId
				LEFT JOIN DataCenterV1.Organize.Organize AS ins
					ON cg.InsuranceCompanyCode = ins.OrganizeCode
				LEFT JOIN SSS.dbo.DB_ClaimHeader h
					ON cg.ClaimCompensateGroupCode = h.ClaimHeaderGroup_id
				LEFT JOIN sss.dbo.DB_Customer  cus
					ON h.App_id = cus.App_id

	) td	
	INNER JOIN #Tmplst lst
		ON td.ClaimHeaderGroupCodeInDB = lst.Element
	WHERE NOT EXISTS (

		SELECT 
			1
		FROM ISC_SmileDoc.dbo.DocumentIndexData dd WITH(NOLOCK)
			LEFT JOIN ISC_SmileDoc.dbo.Document d WITH(NOLOCK)
				ON dd.DocumentID = d.DocumentID
			LEFT JOIN 
			(
				SELECT
					DocumentListID
				FROM ISC_SmileDoc.dbo.DocumentList 
				WHERE DocumentTypeId IN (5,6)
			) dl
			ON d.DocumentListID = dl.DocumentListID
		WHERE dd.DocumentIndexData = td.ClaimHeaderCodeInDB COLLATE DATABASE_DEFAULT

	)
	AND NOT EXISTS (
	
		SELECT 1
		FROM ClaimPayBack.dbo.ClaimHeaderGroupImport H
		WHERE H.ClaimHeaderGroupCode = td.ClaimHeaderGroupCodeInDB
		  AND H.IsActive = 1
		  AND H.ClaimHeaderGroupImportStatusId <> 2
	)
	AND (td.TotalAmountSS > 0 OR td.TotalAmount > 0)

	ORDER BY ProductGroup 

SELECT
    IDENTITY(INT, 1, 1) AS RowNo,
    a.DocumentID,
    a.S3Key
INTO #Pool
FROM 
(
    SELECT TOP(3000)
        MIN(DocumentID) AS DocumentID,  
        S3Key
    FROM ISC_SmileDoc.dbo.Attachment
    WHERE 
        S3IsUploaded = 1
        AND S3Bucket = @S3Bucket
        AND S3Key IS NOT NULL
        AND S3Key <> ''
    GROUP BY 
        S3Key  
) a
ORDER BY 
    NEWID(); 

DECLARE @PoolCount INT;
SELECT @PoolCount = COUNT(*) FROM #Pool;

DELETE FROM #Tmp
WHERE RowNo > @PoolCount;


BEGIN TRY
	Begin TRANSACTION
		COMMIT TRANSACTION

			DECLARE @Document TABLE
			(
				Seq        INT IDENTITY(1,1),
				DocumentID INT
			);

			INSERT INTO ISC_SmileDoc.dbo.Document
			(
				DocumentListID
				,ProjectPermissionID
				,BranchID
				,DocumentDate
				,VoucherRef
				,IsEnable
				,DateAction
				,PersonIDAction
				,DocumentStatusID
				,DateStatus
				,PersonIDStatus
				,IPAddress
				,GUI
			)
			OUTPUT Inserted.DocumentID INTO @Document(DocumentID)
			SELECT 
				1	DocumentListID
				,1	ProjectPermissionID
				,90		BranchID
				,@D		DocumentDate
				,NULL	VoucherRef
				,1		IsEnable
				,@D		DateAction
				,1		PersonIDAction
				,2		DocumentStatusID
				,@D		DateStatus
				,1		PersonIDStatus
				,NULL	IPAddress
				,NULL	GUI
			FROM #Tmp

			SELECT
				t.RowNo,
				d.DocumentID
			INTO #Map
			FROM
			(
				SELECT 
					RowNo,
					ROW_NUMBER() OVER (ORDER BY RowNo) AS Seq
				FROM #Tmp
			) t
			INNER JOIN @Document d
				ON t.Seq = d.Seq;

			INSERT INTO ISC_SmileDoc.dbo.DocumentIndexData
			(
				DocumentID
				,DocumentIndexID
				,DocumentIndexData
				,DateAction
				,PersonIDAction
				,IPAddress
			)
			SELECT
				m.DocumentID              AS DocumentID
				,1                        AS DocumentIndexID
				,t.ClaimHeaderCodeInDB    AS DocumentIndexData
				,@D                       AS DateAction
				,1                        AS PersonIDAction
				,NULL                     AS IPAddress
			FROM #Tmp t
			INNER JOIN #Map m
				ON t.RowNo = m.RowNo;

			INSERT INTO ISC_SmileDoc.dbo.Attachment
			(
				DocumentID
				,AttachmentName
				,AttachmentURL
				,AttachmentSortOrder
				,IsEnable
				,DateAction
				,PersonIDAction
				,IPAddress
				,S3IsUploaded
				,S3UploadedDate
				,S3Bucket
				,S3Key
				,S3StorageType
				,S3StorageTypeUpdateDate
				,IsDelete
				,IsLocalFileDeleted
				,LocalFileDeletedDate
			)
			SELECT
				m.DocumentID     AS DocumentID         
				,NULL            AS AttachmentName
				,NULL            AS AttachmentURL
				,1               AS AttachmentSortOrder
				,1               AS IsEnable
				,@D              AS DateAction
				,1               AS PersonIDAction
				,NULL            AS IPAddress
				,1               AS S3IsUploaded
				,@D              AS S3UploadedDate
				,@S3Bucket       AS S3Bucket
				,p.S3Key         AS S3Key
				,NULL            AS S3StorageType
				,NULL            AS S3StorageTypeUpdateDate
				,NULL            AS IsDelete
				,NULL            AS IsLocalFileDeleted
				,NULL            AS LocalFileDeletedDate
			FROM #Pool p
			INNER JOIN #Tmp t
				ON p.RowNo = t.RowNo  
			INNER JOIN #Map m
				ON t.RowNo = m.RowNo;

		--Result--

		SELECT
			*
		FROM #Tmp

		SELECT
			*
		FROM @Document

END TRY
BEGIN CATCH

	Print('บันทึก ไม่สำเร็จ');

	IF @@Trancount > 0 ROLLBACK;
END CATCH

IF OBJECT_ID('tempdb..#Tmp') IS NOT NULL  DROP TABLE #Tmp;
IF OBJECT_ID('tempdb..#Pool') IS NOT NULL DROP TABLE #Pool;
IF OBJECT_ID('tempdb..#Map') IS NOT NULL DROP TABLE #Map;
IF OBJECT_ID('tempdb..#Tmplst') IS NOT NULL  DROP TABLE #Tmplst;	